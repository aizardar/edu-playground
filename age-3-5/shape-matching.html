<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Shape Matching (Ages 3‚Äì5)</title>
<style>
  :root{
    --bg1:#FFFBF0; --bg2:#FFF0F5;
    --brand:#FF7AC8; --brand2:#7ACBFF;
    --ok:#2ecc71; --oops:#ff6b6b; --card:#ffffff; --ink:#2b2b2b; --muted:#6b7280;
    --ghost:#d1d5db;
    --circle:#FFB86B; --square:#7ACBFF; --triangle:#95E1D3;
  }
  html,body{margin:0;padding:0}
  body{
    font-family:"Comic Sans MS","Trebuchet MS",Arial,sans-serif;
    color:var(--ink);
    min-height:100vh;
    background: radial-gradient(circle at 20% 20%, var(--bg1), var(--bg2) 70%);
    display:flex; flex-direction:column; align-items:center;
  }

  header{
    width:100%; text-align:center; color:#fff;
    background: linear-gradient(135deg, var(--brand), var(--brand2));
    padding:22px 16px; border-bottom-left-radius:20px; border-bottom-right-radius:20px;
    box-shadow:0 6px 18px rgba(0,0,0,.12);
  }
  header h1{ margin:0; font-size:1.9rem; }
  header p{ margin:6px 0 0; opacity:.95; }

  .wrap{ width:min(980px,94%); margin:22px auto; text-align:center; }

  /* Numeric progress 1‚Äì3 */
  .progress{ display:flex; justify-content:center; gap:10px; margin:6px 0 18px; }
  .p-num{
    width:36px; height:36px; line-height:36px; border-radius:10px;
    display:inline-block; font-weight:800; font-size:1rem;
    background:#fff; color:var(--muted); box-shadow:0 3px 10px rgba(0,0,0,.08);
    transition:.2s;
  }
  .p-num.done{ background:#eaf9f0; color:#1f8e54; }
  .p-num.current{ background:#e8f1ff; color:#1751aa; transform:scale(1.06); }

  .card{
    background:var(--card);
    border-radius:20px;
    box-shadow:0 10px 24px rgba(0,0,0,.12);
    padding:18px 16px 22px;
  }
  .q{ font-size:1.15rem; margin:4px 0 12px; }

  /* Targets: ONLY SVG outlines (no boxes) */
  .board{
    display:flex; justify-content:center; align-items:center; gap:26px;
    margin:12px auto 8px; padding:18px;
    background: linear-gradient(180deg,#dff3ff,#ffffff 70%);
    border-radius:16px;
    flex-wrap:wrap;
  }
  .target{
    position:relative; width:160px; height:160px;
    display:flex; align-items:center; justify-content:center;
  }
  .target svg{ width:140px; height:140px; }
  .target.ok .outline{ stroke: var(--ok); }

  /* Pieces tray */
  .tray{ display:flex; justify-content:center; gap:16px; flex-wrap:wrap; margin-top:12px; }
  .drag-wrap{
    width:140px; height:140px; display:flex; align-items:center; justify-content:center;
    background:#ffffffb8; border-radius:16px; box-shadow:0 8px 16px rgba(0,0,0,.08);
    cursor:grab; user-select:none;
  }
  .drag-wrap.lock{ opacity:.45; cursor:default; }
  .drag-wrap.selected{ outline:3px dashed #1751aa; outline-offset:4px; }

  .feedback{ min-height:1.6em; margin:12px 0 0; font-size:1.15rem; font-weight:700; }
  .ok{ color:var(--ok); } .oops{ color:var(--oops); }

  .bar{ display:flex; justify-content:center; gap:10px; margin-top:12px; flex-wrap:wrap; }
  .btn{
    border:none; color:#fff; font-weight:bold; letter-spacing:.5px;
    padding:12px 16px; border-radius:14px; cursor:pointer; font-size:1rem;
    background: linear-gradient(135deg, #FFB86B, #FF7AC8);
    box-shadow:0 8px 16px rgba(255,122,200,.28);
  }
  .btn.alt{ background: linear-gradient(135deg, #e0efff, #bcd9ff); color:#113f86; }

  footer{ margin:16px 0 26px; }
  footer a{ color:#1c66cc; text-decoration:none; font-weight:bold; }

  /* FULL-PAGE CONFETTI */
  .confetti-global{ position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:9999; }
  .confetti-global i{
    position:absolute; top:-10px; width:10px; height:14px; border-radius:2px;
    animation: fall 1.4s ease-in forwards; opacity:.95;
  }
  @keyframes fall{ to{ transform: translateY(110vh) rotate(260deg); opacity:0 } }
</style>
</head>
<body>
  <!-- Full-page confetti -->
  <div class="confetti-global" id="confettiGlobal" aria-hidden="true"></div>

  <header>
    <h1>Shape Matching</h1>
    <p>Drag or tap a shape, then place it on its dashed outline.</p>
  </header>

  <main class="wrap">
    <!-- Numeric progress -->
    <div class="progress" id="progress" aria-label="Match progress"></div>

    <section class="card" aria-live="polite">
      <div class="q">Find where each shape belongs:</div>

      <!-- Targets -->
      <div class="board" id="board">
        <div class="target" data-shape="circle"
             ondragover="event.preventDefault()" ondrop="onDrop(event)" onclick="targetTap(event)">
          <svg viewBox="0 0 140 140" aria-hidden="true">
            <circle class="outline" cx="70" cy="70" r="55"
                    fill="none" stroke="var(--ghost)" stroke-width="8"
                    stroke-dasharray="10 10" />
          </svg>
        </div>

        <div class="target" data-shape="square"
             ondragover="event.preventDefault()" ondrop="onDrop(event)" onclick="targetTap(event)">
          <svg viewBox="0 0 140 140" aria-hidden="true">
            <rect class="outline" x="25" y="25" width="90" height="90" rx="10" ry="10"
                  fill="none" stroke="var(--ghost)" stroke-width="8"
                  stroke-dasharray="10 10" />
          </svg>
        </div>

        <div class="target" data-shape="triangle"
             ondragover="event.preventDefault()" ondrop="onDrop(event)" onclick="targetTap(event)">
          <svg viewBox="0 0 140 140" aria-hidden="true">
            <polygon class="outline" points="70,20 20,120 120,120"
                     fill="none" stroke="var(--ghost)" stroke-width="8"
                     stroke-dasharray="10 10" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>

      <!-- Pieces (draggable wrappers) -->
      <div class="tray" id="tray">
        <div class="drag-wrap piece" id="piece-circle" draggable="true" data-shape="circle"
             ondragstart="onDragStart(event)" ontouchstart="selectPiece(event)" onclick="selectPiece(event)">
          <svg viewBox="0 0 140 140" role="img" aria-label="Circle">
            <circle cx="70" cy="70" r="55" fill="var(--circle)"/>
          </svg>
        </div>
        <div class="drag-wrap piece" id="piece-square" draggable="true" data-shape="square"
             ondragstart="onDragStart(event)" ontouchstart="selectPiece(event)" onclick="selectPiece(event)">
          <svg viewBox="0 0 140 140" role="img" aria-label="Square">
            <rect x="25" y="25" width="90" height="90" rx="10" ry="10" fill="var(--square)"/>
          </svg>
        </div>
        <div class="drag-wrap piece" id="piece-triangle" draggable="true" data-shape="triangle"
             ondragstart="onDragStart(event)" ontouchstart="selectPiece(event)" onclick="selectPiece(event)">
          <svg viewBox="0 0 140 140" role="img" aria-label="Triangle">
            <polygon points="70,20 20,120 120,120" fill="var(--triangle)"/>
          </svg>
        </div>
      </div>

      <div id="feedback" class="feedback" aria-live="polite"></div>

      <div class="bar">
        <button class="btn alt" onclick="resetGame()">üîÑ Reset</button>
      </div>
    </section>

    <footer>
      <a href="index.html">‚Üê Back to Ages 3‚Äì5</a>
    </footer>
  </main>

<script>
  let placed = 0;
  let selectedPieceId = null; // tap-to-place fallback

  const progressEl = document.getElementById('progress');
  const fbEl = document.getElementById('feedback');
  const confettiGlobalEl = document.getElementById('confettiGlobal');

  function buildProgress(){
    progressEl.innerHTML = "";
    for(let i=0;i<3;i++){
      const s = document.createElement('span');
      s.textContent = (i+1);
      s.className = "p-num" + (i < placed ? " done" : i === placed ? " current" : "");
      progressEl.appendChild(s);
    }
  }

  // -------- Desktop drag & drop (HTML5) ----------
  function onDragStart(ev){
    // drag the wrapper div (not the inner SVG)
    ev.dataTransfer.setData("id", ev.currentTarget.id);
  }
  function onDrop(ev){
    ev.preventDefault();
    const pieceId = ev.dataTransfer.getData("id");
    tryPlace(document.getElementById(pieceId), ev.currentTarget);
  }

  // -------- Touch / Tap fallback ----------
  function selectPiece(ev){
    const wrap = ev.currentTarget.closest('.drag-wrap');
    if (!wrap || wrap.classList.contains('lock')) return;
    // toggle selection
    document.querySelectorAll('.drag-wrap').forEach(w => w.classList.remove('selected'));
    wrap.classList.add('selected');
    selectedPieceId = wrap.id;
    fb("Now tap the matching outline.", "ok");
  }
  function targetTap(ev){
    if(!selectedPieceId) return;
    const piece = document.getElementById(selectedPieceId);
    tryPlace(piece, ev.currentTarget);
  }

  // -------- Shared place logic ----------
  function tryPlace(pieceWrap, target){
    if(!pieceWrap || !target || pieceWrap.classList.contains('lock')) return;
    const need = target.dataset.shape;
    const have = pieceWrap.dataset.shape;

    if(need === have){
      // lock both
      target.classList.add('ok');
      pieceWrap.classList.add('lock');
      pieceWrap.setAttribute('draggable','false');
      pieceWrap.classList.remove('selected');

      // clear outline and mount the piece wrapper centered in target
      target.innerHTML = "";
      // ensure target is a flex container:
      target.style.display = "flex";
      target.style.alignItems = "center";
      target.style.justifyContent = "center";
      target.appendChild(pieceWrap);

      placed++; buildProgress();
      fb("Great match!", "ok");
      confettiBurst(42);

      selectedPieceId = null;

      if(placed === 3){
        setTimeout(()=> { fb("All shapes matched! üéâ", "ok"); confettiBurst(100); }, 200);
      }
    } else {
      fb("Try a different outline!", "oops");
    }
  }

  function fb(msg, cls){ fbEl.className = "feedback " + cls; fbEl.textContent = msg; }

  function confettiBurst(pieces){
    confettiGlobalEl.innerHTML = "";
    const colors = ["#FF7AC8","#7ACBFF","#FFD166","#95E1D3","#C3F584"];
    for(let i=0;i<pieces;i++){
      const p = document.createElement('i');
      p.style.left = (Math.random()*96+2) + "%";
      p.style.background = colors[i%colors.length];
      p.style.transform = `translateY(0) rotate(${Math.random()*120}deg)`;
      p.style.animationDelay = (Math.random()*0.35) + "s";
      p.style.width = (8 + Math.random()*6) + "px";
      p.style.height = (10 + Math.random()*10) + "px";
      confettiGlobalEl.appendChild(p);
    }
    setTimeout(()=> confettiGlobalEl.innerHTML = "", 1800);
  }

  function resetGame(){
    placed = 0; selectedPieceId = null; fbEl.textContent = ""; buildProgress();

    // rebuild board outlines (SVG only)
    const board = document.getElementById('board');
    board.innerHTML = `
      <div class="target" data-shape="circle"
           ondragover="event.preventDefault()" ondrop="onDrop(event)" onclick="targetTap(event)">
        <svg viewBox="0 0 140 140"><circle class="outline" cx="70" cy="70" r="55" fill="none" stroke="var(--ghost)" stroke-width="8" stroke-dasharray="10 10"/></svg>
      </div>
      <div class="target" data-shape="square"
           ondragover="event.preventDefault()" ondrop="onDrop(event)" onclick="targetTap(event)">
        <svg viewBox="0 0 140 140"><rect class="outline" x="25" y="25" width="90" height="90" rx="10" ry="10" fill="none" stroke="var(--ghost)" stroke-width="8" stroke-dasharray="10 10"/></svg>
      </div>
      <div class="target" data-shape="triangle"
           ondragover="event.preventDefault()" ondrop="onDrop(event)" onclick="targetTap(event)">
        <svg viewBox="0 0 140 140"><polygon class="outline" points="70,20 20,120 120,120" fill="none" stroke="var(--ghost)" stroke-width="8" stroke-dasharray="10 10" stroke-linejoin="round"/></svg>
      </div>
    `;

    // rebuild tray pieces (wrappers are draggable)
    const tray = document.getElementById('tray');
    tray.innerHTML = `
      <div class="drag-wrap piece" id="piece-circle" draggable="true" data-shape="circle"
           ondragstart="onDragStart(event)" ontouchstart="selectPiece(event)" onclick="selectPiece(event)">
        <svg viewBox="0 0 140 140" role="img" aria-label="Circle"><circle cx="70" cy="70" r="55" fill="var(--circle)"/></svg>
      </div>
      <div class="drag-wrap piece" id="piece-square" draggable="true" data-shape="square"
           ondragstart="onDragStart(event)" ontouchstart="selectPiece(event)" onclick="selectPiece(event)">
        <svg viewBox="0 0 140 140" role="img" aria-label="Square"><rect x="25" y="25" width="90" height="90" rx="10" ry="10" fill="var(--square)"/></svg>
      </div>
      <div class="drag-wrap piece" id="piece-triangle" draggable="true" data-shape="triangle"
           ondragstart="onDragStart(event)" ontouchstart="selectPiece(event)" onclick="selectPiece(event)">
        <svg viewBox="0 0 140 140" role="img" aria-label="Triangle"><polygon points="70,20 20,120 120,120" fill="var(--triangle)"/></svg>
      </div>
    `;
  }

  // init
  buildProgress();
</script>
</body>
</html>
